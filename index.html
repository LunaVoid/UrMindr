<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>


<body>
    <button onclick="toggleStart()">Click for speech recognition</button>
    <p class = "here"></p>
</body>
<script>

const recognition = new webkitSpeechRecognition();

recognition.onstart = function() {
    console.log('Speech recognition service has started');
};

recognition.onend = async function() {
    console.log('Speech recognition service disconnected');
};

recognition.onresult = async function(event) {
    const transcript = event.results[0][0].transcript;
    console.log('Result received: ' + transcript);
    let ptag = document.getElementsByClassName('here');
    ptag.innerHtml=transcript;
    console.log(transcript)
    const url = "http://127.0.0.1:5000/api/toolcall"

    try {
        const response = await fetch(url,{
            method:"POST",
            headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json'
            },
            body: JSON.stringify({ prompt: transcript })
            
        })
    if (!response.ok) {
        throw new Error(`Response status: ${response.status}`);
    }

    const result = await response.json();
    console.log(result);
  } catch (error) {
    console.error(error.message);
  }
};

function toggleStart(){
    console.log("running")
    if(!started){
        recognition.start();
        started = true; 
    }
    else{
        recognition.stop();
        started = false;
    }

}
</script>
</html>